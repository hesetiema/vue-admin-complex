# Javascript è¿›é˜¶ğŸŒ

## ä¸€ã€æ•°æ®ç±»å‹

### 1ã€åŸºæœ¬ç±»å‹

åŸºæœ¬ç±»å‹ï¼ˆåŸå§‹ç±»å‹ï¼‰æ•°æ®**å€¼å­˜å‚¨åœ¨æ ˆ(stack)ä¸­**ã€‚åŸºæœ¬åŒ…è£…ç±»å‹`Numberã€Stringã€Boolean`ä½œä¸ºå†…ç½®å¯¹è±¡ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¼•ç”¨ç±»å‹ã€‚

- numberï¼šé‡‡ç”¨ IEEE754 æ ‡å‡†ä¸­**åŒç²¾åº¦æµ®ç‚¹æ•° 64 ä½**(8 ä¸ªå­—èŠ‚)å­˜å‚¨ï¼Œä¸åŒºåˆ†æ•´æ•°

  - ç¬¦å·ä½(1 bit)
  - æŒ‡æ•°ä½(11 bit)ï¼š$0 \leq e \leq 2^{11} -1=2047$
    - åç§»ç»“æœï¼š$-1023 \leq e-bias \leq 1024$
    - æ•°å€¼èŒƒå›´ï¼š[Number.MIN_VALUE,Number.MAX_VALUE]=[$2^{-1023}$,$2^{1024}$]
  - å°æ•°ä½(52 bit)

    - æ•°å€¼ç²¾åº¦ï¼šIEEE754 è§„å®šï¼Œæœ‰æ•ˆæ•°å­—ç¬¬ä¸€ä½é»˜è®¤æ€»æ˜¯ 1 ã€‚å› æ­¤ï¼Œåœ¨è¡¨ç¤ºç²¾åº¦çš„ä½æ•°å‰é¢ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ª â€œéšè—ä½â€ ï¼Œå›ºå®šä¸º 1
    - å¯å®‰å…¨ç²¾ç¡®è¿ç®—çš„æ•´æ•°èŒƒå›´ï¼š[$-2^{53}-1$ï¼Œ$2^{53}-1$]
      - æ£€æŸ¥å®‰å…¨æ€§ï¼šä½¿ç”¨ ES6 `Number.isSafeInteger()`
      - å¤§æ•´æ•°è®¡ç®—ï¼šé’ˆå¯¹è¶…å‡ºå®‰å…¨æ•´æ•°èŒƒå›´çš„å¤§æ•´æ•°ï¼Œåœ¨ es10 ä¸­åŠ å…¥äº†ç¬¬ä¸ƒç§åŸå§‹ç±»å‹`BigInt`ï¼Œå¯æ“ä½œè¶…è¿‡æœ€å¤§å®‰å…¨æ•°å­—çš„æ•°å­—

    ```js
    console.log({
      max: Number.MAX_SAFE_INTEGER,
      min: Number.MIN_SAFE_INTEGER
    });
    // {max: 9007199254740991, min: -9007199254740991}
    ```

    - **ç²¾åº¦ä¸¢å¤±**ï¼š**æµ®ç‚¹æ•°è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å‡ºç°æ— é™å¾ªç¯æ—¶ï¼Œå¿…é¡» 0 èˆ 1 å…¥å¤„ç†**
      - å¦‚`console.log(.1 + .2); // 0.30000000000000004`
      - å¦‚æœè¦ä½¿ç”¨ä»»æ„ç²¾åº¦çš„åè¿›åˆ¶è¿ç®—ï¼Œè¯·ä½¿ç”¨`big.js`ï¼Œæ­¤åº“ä¸é€‚ç”¨äº UI /æ€§èƒ½å¯†é›†å‹ç›®çš„çš„æ•°å­¦è¿ç®—ï¼Œä¾‹å¦‚å›¾è¡¨ï¼Œç”»å¸ƒç»˜åˆ¶ç­‰

- stringï¼šé‡‡ç”¨ UTF-16ï¼ˆ16 ä½ Unicode å­—ç¬¦ï¼‰ç¼–ç  ï¼Œä¸­è‹±æ–‡å­—ç¬¦å‡å ç”¨ 2 ä¸ªå­—èŠ‚
- booleanï¼šä¸¤å­—é¢å€¼ï¼štrueã€falseï¼Œæ‰€æœ‰ç±»å‹å€¼éƒ½å¯è½¬åŒ–ä¸ºä¸ boolean ç­‰ä»·çš„å€¼
- symbolï¼šè¡¨ç¤ºå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚å¯ä½œä¸ºå¯¹è±¡å”¯ä¸€çš„å±æ€§åï¼Œåˆ›å»ºå¯¹è±¡çš„â€œéšè—â€å±æ€§
- undefinedï¼šæœªå®šä¹‰çš„å€¼ã€‚è¡¨ç¤ºä¸€ä¸ªå˜é‡æœ€åŸå§‹çš„çŠ¶æ€ï¼Œè€Œéäººä¸ºæ“ä½œçš„ç»“æœ
- nullï¼šè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡è¢«äººä¸ºé‡ç½®ä¸ºç©ºï¼Œè€Œéä¸€ä¸ªå˜é‡æœ€åŸå§‹çš„çŠ¶æ€
  - typeof null == 'object'ï¼š
    - **äºŒè¿›åˆ¶çš„å¼€å¤´ 000 ä¼šè¢« typeof åˆ¤å®šä¸ºå¯¹è±¡ç±»å‹ï¼Œ è€Œ null å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºå…¨æ˜¯ 0ã€‚æ•…å°†å…¶è¯¯åˆ¤ä¸ºå¯¹è±¡ç±»å‹**
  - è·å¾—æ­£ç¡®ç±»å‹æ–¹æ³•ï¼š
    - `Object.prototype.toString.call(null);// [object Null]`

### 2ã€å¼•ç”¨ç±»å‹

å¼•ç”¨ç±»å‹æ•°æ®**å€¼å­˜å‚¨åœ¨å †(heap)ä¸­ï¼Œå˜é‡æŒ‡é’ˆå°†å†…å­˜åœ°å€å­˜å‚¨åˆ°æ ˆä¸­**ã€‚å¼•ç”¨ç±»å‹é™¤ Object æœ¬èº«å¤–ï¼ŒArrayã€Functionã€Dateã€RegExp ä¹Ÿå±äºå¼•ç”¨ç±»å‹

- åº•å±‚æ•°æ®ç»“æ„ï¼šæ‰€æœ‰ js å¯¹è±¡éƒ½æ˜¯åŸºäºä¸€ä¸ªåä¸º HeapObject çš„ç±»ç”Ÿæˆçš„ã€‚ç”Ÿæˆå¯¹è±¡çš„æ—¶å€™ï¼Œå¼•æ“é€šè¿‡è¿™ä¸ªç±»å‘ Heap ç”³è¯·ç©ºé—´
  - å¯¹è±¡çš„å‚¨å­˜ç»“æ„ï¼šå¤´éƒ¨ä¿¡æ¯ã€å±æ€§å—ï¼Œå­˜çš„æ˜¯ k-v å€¼å½¢å¼çš„é›†åˆã€å…ƒç´ å—ï¼ŒæŒ‰ç…§å†…å­˜çš„ç»“æ„å­˜å‚¨çš„çœŸæ­£æ•°ç»„
- æµ…æ‹·è´ï¼šä»…èƒ½æ‹·è´æŒ‡å‘åŸºæœ¬ç±»å‹çš„å¯¹è±¡å±æ€§ã€‚å¦‚`Object.assign({},obj);`
- æ·±æ‹·è´ï¼šå½»åº•æ‹·è´ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‰¯æœ¬ï¼Œä¸¤è€…é—´çš„æ“ä½œç›¸äº’ä¸å—å½±å“ã€‚

## äºŒã€æ‰§è¡Œä¸Šä¸‹æ–‡ã€æ‰§è¡Œæ ˆä¸å†…å­˜æœºåˆ¶

### 1ã€æ‰§è¡Œä¸Šä¸‹æ–‡

æ‰§è¡Œä¸Šä¸‹æ–‡(EC)æ˜¯å½“å‰ JavaScript ä»£ç è¢«è§£æå’Œæ‰§è¡Œæ—¶æ‰€åœ¨ç¯å¢ƒçš„æŠ½è±¡æ¦‚å¿µã€‚

- ç±»å‹
  - å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šåªæœ‰ä¸€ä¸ªï¼Œæµè§ˆå™¨ä¸­çš„å…¨å±€å¯¹è±¡å°±æ˜¯ window å¯¹è±¡
  - å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šå­˜åœ¨æ— æ•°ä¸ªï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡
- åˆ›å»º
  - **This Binding**ï¼šç¡®å®š this çš„å€¼
    - å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šæµè§ˆå™¨ä¸­ this->windowï¼›Nodejs ä¸­ this->module
    - å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œthis çš„å€¼å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼
  - **LE(è¯æ³•ç¯å¢ƒ)** ç»„ä»¶åˆ›å»ºï¼š**ç”¨äºå­˜å‚¨å‡½æ•°å£°æ˜å’Œå˜é‡(letã€const)ç»‘å®š**
    - ç¯å¢ƒè®°å½•ï¼šå­˜å‚¨å˜é‡å’Œå‡½æ•°å£°æ˜çš„å®é™…ä½ç½®ã€‚å¦‚ç”¨æˆ·åœ¨å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡è¢«å­˜å‚¨åœ¨ç¯å¢ƒè®°å½•ä¸­ï¼ŒåŒ…å«äº† arguments å¯¹è±¡
    - å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨ï¼šå¯ä»¥è®¿é—®å…¶å¤–éƒ¨è¯æ³•ç¯å¢ƒ
  - **VE(å˜é‡ç¯å¢ƒ)** ç»„ä»¶åˆ›å»ºï¼š**ä»…ç”¨äºå­˜å‚¨å˜é‡(var)ç»‘å®š**
- æ‰§è¡Œï¼šå®Œæˆå¯¹æ‰€æœ‰å˜é‡çš„åˆ†é…ï¼Œæœ€åæ‰§è¡Œä»£ç 

### 2ã€æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ

JS å¼•æ“åˆ›å»ºäº†æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼ˆExecution context stackï¼ŒECSï¼‰æ¥ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ï¼Œç”¨æ´»åŠ¨å¯¹è±¡(activation object, AO)æ¥è¡¨ç¤ºå˜é‡å¯¹è±¡ã€‚

![avatar](http://resource.muyiy.cn/image/2019-07-24-060256.jpg)

- å‡½æ•°ä¸Šä¸‹æ–‡ï¼šè°ƒç”¨å‡½æ•°æ—¶ï¼Œè‡ªåŠ¨åˆå§‹åŒ–å±€éƒ¨å˜é‡ arguments æŒ‡ä»£ Arguments å¯¹è±¡ã€‚æ‰€æœ‰ä½œä¸ºå‚æ•°ä¼ å…¥çš„å€¼éƒ½ä¼šæˆä¸º Arguments å¯¹è±¡çš„æ•°ç»„å…ƒç´ 
  - **å˜é‡å¯¹è±¡(VO)**ï¼šåŒ…å«å˜é‡/å‡½æ•°å£°æ˜ã€å‡½æ•°çš„å½¢å‚ï¼Œåªèƒ½åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­è®¿é—®
  - **æ´»åŠ¨å¯¹è±¡(AO)**ï¼šè¿›å…¥åˆ°ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡åï¼Œå˜é‡å¯¹è±¡è¢«æ¿€æ´»ä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œå„ç§å±æ€§æ‰èƒ½è¢«è®¿é—®
- æ‰§è¡Œè¿‡ç¨‹ï¼šè¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡ã€ä»£ç æ‰§è¡Œ
- æ€»ç»“
  - å…¨å±€ä¸Šä¸‹æ–‡çš„ VO åˆå§‹åŒ–æ˜¯å…¨å±€å¯¹è±¡
  - å‡½æ•°ä¸Šä¸‹æ–‡çš„ VO åˆå§‹åŒ–åªåŒ…æ‹¬ Arguments å¯¹è±¡
  - åœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ä¼šç»™ VO æ·»åŠ å½¢å‚ã€å‡½æ•°/å˜é‡å£°æ˜ç­‰åˆå§‹çš„å±æ€§å€¼
  - åœ¨ä»£ç æ‰§è¡Œé˜¶æ®µï¼Œä¼šå†æ¬¡ä¿®æ”¹ VO çš„å±æ€§å€¼

### 3ã€å†…å­˜æœºåˆ¶

**è‡ªåŠ¨åƒåœ¾æ”¶é›†æœºåˆ¶**ï¼šæ”¶é›†å™¨æ¯éš”ä¸€æ®µæ—¶é—´æ‰¾å‡ºä¸å†ç»§ç»­ä½¿ç”¨çš„å€¼ï¼Œé‡Šæ”¾å…¶å ç”¨çš„å†…å­˜

- å˜é‡é”€æ¯
  - å±€éƒ¨å˜é‡ï¼šå±€éƒ¨ä½œç”¨åŸŸä¸­ï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå±€éƒ¨å˜é‡æ— å­˜åœ¨çš„å¿…è¦
  - å…¨å±€å˜é‡ï¼šå¾ˆéš¾åˆ¤æ–­ä½•æ—¶éœ€é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œå¼€å‘ä¸­**å°½é‡é¿å…ä½¿ç”¨å…¨å±€å˜é‡**
- åƒåœ¾å›æ”¶ç®—æ³•ï¼šæ ‡è®°æ¸…é™¤ï¼Œä»æ ¹éƒ¨å‡ºå‘å®šæ—¶æ‰«æå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå‡¡æ˜¯èƒ½ä»æ ¹éƒ¨åˆ°è¾¾çš„å¯¹è±¡ï¼Œæ ‡è®°å¯è¾¾ï¼Œä¿ç•™ï¼›ä»æ ¹éƒ¨å‡ºå‘æ— æ³•è§¦åŠåˆ°çš„å¯¹è±¡ï¼Œæœªè¢«æ ‡è®°è¿›è¡Œå›æ”¶
- WeakSet/WeakMapï¼šè¡¨ç¤ºè¿™æ˜¯å¼±å¼•ç”¨ï¼Œå®ƒä»¬å¯¹äºå€¼çš„å¼•ç”¨éƒ½ä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶

**å†…å­˜æ³„æ¼**ï¼šå¯¹äºä¸å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰

- æ„å¤–çš„å…¨å±€å˜é‡ï¼šæœªå®šä¹‰çš„å˜é‡æˆ–å‡½æ•°è°ƒç”¨è‡ªèº«ï¼Œthis æŒ‡å‘å…¨å±€å¯¹è±¡ window
  - åœ¨ JavaScript æ–‡ä»¶å¤´éƒ¨åŠ ä¸Š 'use strict'ï¼Œä½¿ç”¨ä¸¥æ ¼æ¨¡å¼é¿å…æ„å¤–çš„å…¨å±€å˜é‡
  - å¿…é¡»ä½¿ç”¨å…¨å±€å˜é‡å­˜å‚¨å¤§é‡æ•°æ®æ—¶ï¼Œç¡®ä¿ç”¨å®Œåè®¾ç½®ä¸º null æˆ–é‡æ–°å®šä¹‰
- è„±ç¦» DOM çš„å¼•ç”¨ï¼šæŠŠ DOM å­˜æˆå­—å…¸ï¼ˆJSON é”®å€¼å¯¹ï¼‰æˆ–è€…æ•°ç»„ï¼ŒåŒæ ·çš„ DOM å…ƒç´ å­˜åœ¨ä¸¤ä¸ªå¼•ç”¨ï¼šDOM æ ‘ã€å­—å…¸ã€‚é‚£ä¹ˆå°†æ¥éœ€è¦æŠŠä¸¤ä¸ªå¼•ç”¨éƒ½æ¸…é™¤
- é—­åŒ…ï¼šåŒ¿åå‡½æ•°å¯ä»¥è®¿é—®çˆ¶çº§ä½œç”¨åŸŸçš„å˜é‡ã€‚å¯æŠŠéœ€æ¸…æ¥šçš„å˜é‡è®¾ç½®ä¸º null

## ä¸‰ã€ä½œç”¨åŸŸé“¾ä¸é—­åŒ…

### 1ã€ä½œç”¨åŸŸé“¾

- å«ä¹‰ï¼šå½“è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼Œè§£é‡Šå™¨ä¼šé¦–å…ˆåœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾æ ‡ç¤ºç¬¦ï¼Œæ²¡æœ‰æ‰¾åˆ°å†å»çˆ¶ä½œç”¨åŸŸæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å…¨å±€å¯¹è±¡ä¸­æˆ–è¿”å› undefined
- ç†è§£ï¼šå«è‡ªèº«å˜é‡å¯¹è±¡å’Œä¸Šçº§å˜é‡å¯¹è±¡çš„åˆ—è¡¨ï¼Œç”±`[[Scope]]`å±æ€§æŸ¥æ‰¾ä¸Šçº§å˜é‡
  å¦‚`fContext = {Scope: [AO, checkscopeContext.AO, globalContext.VO],}`

### 2ã€é—­åŒ…

é—­åŒ…ï¼Œå³ã€**æœ‰æƒè®¿é—®å¤–å±‚å‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡çš„å‡½æ•°**ã€‘ã€‚**å³ä½¿åˆ›å»ºå˜é‡çš„ä¸Šä¸‹æ–‡å·²ç»é”€æ¯ï¼Œå˜é‡ä»ç„¶ç»‘å®šåœ¨å†…éƒ¨å‡½æ•°ã€‚**

- ä¼˜ç‚¹ï¼šå®ƒå…è®¸æ‚¨è½»æ¾ç»„åˆå¯¹è±¡ï¼Œä¾‹å¦‚æ˜¾ç¤ºæ¨¡å—æ¨¡å¼

## å››ã€åŸå‹ä¸ç»§æ‰¿

### 1ã€åŸå‹

æ¯ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œå¯¹è±¡ä»¥å…¶åŸå‹ä¸ºæ¨¡æ¿ï¼Œä»åŸå‹ç»§æ‰¿æ–¹æ³•å’Œå±æ€§ï¼Œè¿™äº›å±æ€§å’Œæ–¹æ³•å®šä¹‰åœ¨å¯¹è±¡çš„æ„é€ å™¨å‡½æ•°çš„ prototype å±æ€§ä¸Šï¼Œè€Œéå¯¹è±¡å®ä¾‹æœ¬èº«ã€‚

- æ„é€ å‡½æ•°ï¼šä½¿ç”¨ new ç”Ÿæˆå®ä¾‹çš„å‡½æ•°ï¼Œé¦–å­—æ¯å¤§å†™
  - Symbol ä¸æ˜¯æ„é€ å‡½æ•°ï¼Œä¸æ”¯æŒè¯­æ³• new Symbol()ã€‚ä½†å…¶åŸå‹ä¸Šæ‹¥æœ‰ constructor å±æ€§ï¼Œå³ Symbol.prototype.constructor
- constructorï¼šè¿”å›åˆ›å»ºå®ä¾‹å¯¹è±¡æ—¶æ„é€ å‡½æ•°çš„å¼•ç”¨
  - å¯¹äºå¼•ç”¨ç±»å‹ï¼Œ`constructor`å±æ€§å€¼æ˜¯å¯ä»¥ä¿®æ”¹çš„
  - å¯¹äºåŸºæœ¬ç±»å‹(nullã€undefined æ—  constructor å±æ€§)ï¼Œ`constructor`å±æ€§å€¼åªè¯»

```js
function Parent(age) {
  this.age = age;
}
var p = new Parent(50);
p.constructor === Parent; // true
p.constructor === Object; // false
```

![avatar](http://resource.muyiy.cn/image/2019-07-24-060305.jpg)

### 2ã€åŸå‹é“¾

æ¯ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œé€šè¿‡`__proto__`æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€ä¸ªåŸå‹ ï¼Œå¹¶ä»ä¸­**ç»§æ‰¿**æ–¹æ³•å’Œå±æ€§ï¼ŒåŒæ—¶åŸå‹å¯¹è±¡ä¹Ÿå¯èƒ½æ‹¥æœ‰åŸå‹ï¼Œè¿™æ ·ä¸€å±‚å±‚æœ€ç»ˆæŒ‡å‘ nullï¼Œè¿™å°±æ˜¯åŸå‹é“¾ã€‚

![avatar](http://resource.muyiy.cn/image/2019-07-24-060308.jpg)

- `__proto__`æ˜¯æ¯ä¸ªå®ä¾‹ä¸Šéƒ½æœ‰çš„å±æ€§ï¼Œå› ä¸ºæ€§èƒ½é—®é¢˜ä¸æ¨èä½¿ç”¨ï¼Œæ¨èä½¿ç”¨ `Object.getPrototypeOf()`ã€‚ä½†åŸå‹é“¾çš„æ„å»ºä¾èµ–äº`__proto__`
- `prototype`æ˜¯æ„é€ å‡½æ•°çš„å±æ€§ï¼Œåœ¨å®ä¾‹ä¸Šå¹¶ä¸å­˜åœ¨
- `foo.constructor.prototype==foo.__proto__`

### 3ã€ç»§æ‰¿

åŸå‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§è¢«**ç»§æ‰¿**åˆ°æ–°å¯¹è±¡ä¸­ï¼Œå¹¶ä¸æ˜¯è¢«å¤åˆ¶åˆ°æ–°å¯¹è±¡

- instanceofï¼šåˆ¤æ–­å¯¹è±¡çš„åŸå‹é“¾ä¸­æ˜¯ä¸æ˜¯èƒ½æ‰¾åˆ°ç±»å‹çš„ prototype
- ç»§æ‰¿æ–¹æ¡ˆï¼šåŸå‹é“¾ç»§æ‰¿çš„æœ¬è´¨æ˜¯é‡å†™åŸå‹å¯¹è±¡ï¼Œä»£ä¹‹ä»¥ä¸€ä¸ªæ–°ç±»å‹çš„å®ä¾‹ã€‚æ—¥å¸¸ä½¿ç”¨ ES6 Class extendsï¼ˆæ¨¡æ‹ŸåŸå‹ï¼‰ç»§æ‰¿æ–¹æ¡ˆå³å¯

## äº”ã€this è§£æã€call/apply/bind åŸç†

### 1ã€this è§£æ

- é»˜è®¤ç»‘å®šï¼šå‡½æ•°ä½“ä¸¥æ ¼æ¨¡å¼ä¸‹ç»‘å®šåˆ° undefinedï¼Œå¦åˆ™ç»‘å®šåˆ°å…¨å±€å¯¹è±¡ window
  - **é«˜é˜¶å‡½æ•°è°ƒç”¨æœ€åº•å±‚æ—¶ï¼Œé»˜è®¤ç»‘å®šä¸ºå…¨å±€å¯¹è±¡ windowï¼ˆç®­å¤´å‡½æ•°é™¤å¤–ï¼‰**
- éšå¼ç»‘å®šï¼šå½“å‡½æ•°å¼•ç”¨æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡æ—¶ï¼Œå‡½æ•°ä¸­çš„ this ç»‘å®šåˆ°è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ã€‚
  - éšå¼ä¸¢å¤±ï¼šè¢«éšå¼ç»‘å®šçš„å‡½æ•°ç‰¹å®šæƒ…å†µä¸‹ä¼šä¸¢å¤±ç»‘å®šå¯¹è±¡ï¼Œåº”ç”¨é»˜è®¤ç»‘å®š
    - **å‡½æ•°é—´æ¥å¼•ç”¨å¤åˆ¶å†è°ƒç”¨ï¼Œéšå¼ä¸¢å¤±**
- æ˜¾å¼ç»‘å®šï¼šé€šè¿‡`func.apply(context,args)ã€func.call(context,arg1,arg2,...)ã€func.bind(context,arg1,arg2,...)`æ–¹æ³•ç›´æ¥æŒ‡å®š this çš„ç»‘å®šå¯¹è±¡
  - åº”ç”¨åœºæ™¯
    - åˆ›å»ºåŒ…è£¹å‡½æ•°ï¼Œè´Ÿè´£æ¥æ”¶å‚æ•°å¹¶è¿”å›å€¼
    - æ–¹æ³•å€Ÿç”¨ï¼š`[].join.call(arguments)`å€Ÿç”¨è¿æ¥æ–¹æ³•
    - åˆ©ç”¨ bind()å°† this ç»‘å®šåˆ°è°ƒåº¦å‡½æ•°ï¼š`setTimeout(func.bind(this),delay)`
- new ç»‘å®šï¼šä½¿ç”¨ new æ¥è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œthis ç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œæ— æ³•è¢«ä¿®æ”¹

  - **æ‰‹å†™ä¸€ä¸ª new**

```js
//è§„å®š myNew æ¥æ”¶å‚æ•°çš„æ–¹å¼ï¼šlet object1 = myNew(Constructor,arg1,...)
function myNew() {
  // è·å¾—æ„é€ å‡½æ•°
  let Con = [].shift.call(arguments);
  // åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡é“¾æ¥åˆ°åŸå‹ï¼Œobj å¯ä»¥è®¿é—®æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§
  let obj = Object.create(Con.prototype);
  // ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§
  let result = Con.apply(obj, arguments);
  // ä¼˜å…ˆè¿”å›æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡
  return result instanceof Object ? result : obj;
}
```

- ä¼˜å…ˆçº§ï¼š**new ç»‘å®š->æ˜¾å¼ç»‘å®š->éšå¼ç»‘å®š->é»˜è®¤ç»‘å®š**
- ç®­å¤´å‡½æ•°ï¼šæ ¹æ®**å¤–å±‚ï¼ˆå‡½æ•°æˆ–å…¨å±€ï¼‰è¯æ³•ä½œç”¨åŸŸ**æ¥å†³å®š this
  - ç®­å¤´å‡½æ•°ä¸ç»‘å®š thisï¼Œç®­å¤´å‡½æ•°ä¸­çš„ this ç›¸å½“äºæ™®é€šå˜é‡
  - **ç®­å¤´å‡½æ•°çš„ this æ— æ³•é€šè¿‡`bindï¼Œcallï¼Œapply`æ¥ç›´æ¥ä¿®æ”¹**ï¼ˆå¯ä»¥é—´æ¥ä¿®æ”¹ï¼‰
  - æ”¹å˜å¤–å±‚ä½œç”¨åŸŸä¸­ this çš„æŒ‡å‘å¯ä»¥æ”¹å˜ç®­å¤´å‡½æ•°çš„ this

### 2ã€call/apply

- call/applyï¼š`fn.apply(context,args);fn.call(context,...args);//argsä¸ºå‚æ•°æ•°ç»„`
  - å€Ÿç”¨æ•°ç»„æ–¹æ³•
    - `[].join.call(arguments);`ç±»æ•°ç»„å¯¹è±¡å€Ÿç”¨è¿æ¥æ–¹æ³•
  - å€Ÿç”¨ Math çš„æ–¹æ³•
    - `Math.max.apply(Math, numbers);`å€Ÿç”¨æ±‚æœ€å¤§å€¼æ–¹æ³•
  - æ•°æ®ç±»å‹æ£€æµ‹ï¼š`Object.prototype.toString.call(obj)`
- æ¨¡æ‹Ÿå®ç° call

```js
Function.prototype.myCall = function(context) {
  if (typeof this !== "function") {
    throw new TypeError("Error");
  }
  context = context || window; //åˆ¤æ–­ this ç»‘å®šçš„æ•°æ®ç±»å‹
  const fn = Symbol("fn");
  context[fn] = this; //å°†å‡½æ•°è®¾ç½®ä¸ºå¯¹è±¡çš„éšå½¢å±æ€§
  const args = [...arguments].slice(1);
  const result = context[fn](...args); //æ‰§è¡Œå‡½æ•°
  delete context[fn];
  return result;
};
```

- æ¨¡æ‹Ÿå®ç° apply

```js
Function.prototype.myApply = function(context, arr) {
  if (typeof this !== "function") {
    throw new TypeError("Error");
  }
  context = context || window; //åˆ¤æ–­ this ç»‘å®šçš„æ•°æ®ç±»å‹
  const fn = Symbol("fn");
  context[fn] = this; //å°†å‡½æ•°è®¾ç½®ä¸ºå¯¹è±¡çš„éšå½¢å±æ€§
  const result = !arr ? context.fn() : context.fn(...arr);
  delete context[fn];
  return result;
};
```

### 3ã€bind

- è¯­æ³•ï¼š`fn.bind(thisArg[, arg1[, arg2[, ...]]])`
- ä¸`call/apply`åŒºåˆ«ï¼šbind æ–¹æ³•è¿”å›ä¸€ä¸ªç»‘å®šä¸Šä¸‹æ–‡çš„å‡½æ•°ï¼Œè€Œä¸ç›´æ¥æ‰§è¡Œå‡½æ•°
- ç‰¹ç‚¹ï¼šå¯ä»¥ç»‘å®š thisã€ä¼ å…¥å‚æ•°ã€æŸ¯é‡ŒåŒ–ã€è¿”å›ä¸€ä¸ªå‡½æ•°
- åº”ç”¨
  - è§£å†³è°ƒåº¦é‡Œçš„ this æŒ‡å‘é—®é¢˜ï¼ˆé»˜è®¤æŒ‡å‘ window å…¨å±€å¯¹è±¡ï¼‰
    - åˆ©ç”¨ bind()å°† this ç»‘å®šåˆ°è¿™ä¸ªå‡½æ•°ä¸Šï¼šsetTimeout(func.bind(this),delay)
    - åˆ©ç”¨ç®­å¤´å‡½æ•°å°† this æŒ‡å‘å¤–å±‚è°ƒç”¨è€…ï¼šsetTimeout(() => {...}, delay)
  - æŸ¯é‡ŒåŒ–ï¼šåªä¼ é€’ç»™å‡½æ•°ä¸€éƒ¨åˆ†å‚æ•°ï¼Œè®©å®ƒè¿”å›å¦ä¸€ä¸ªå‡½æ•°å¤„ç†å‰©ä¸‹çš„å‚æ•°
- æ¨¡æ‹Ÿå®ç° bind

```js
Function.prototype.myBind = function(context) {
  if (typeof this !== "function") {
    throw new TypeError("Error");
  }
  const self = this; // this æŒ‡å‘è°ƒç”¨è€…
  const args = [...arguments].slice(1);
  return function F() {
    // å¦‚æœè¢« new åˆ›å»ºå®ä¾‹ï¼Œä¸ä¼šè¢«æ”¹å˜ä¸Šä¸‹æ–‡ï¼
    if (this instanceof F) {
      return new self(...args, ...arguments);
    }
    return self.apply(context, args.concat(...arguments));
  };
};
```

## å…­ã€æ·±æµ…æ‹·è´

### 1ã€æµ…æ‹·è´

- å®šä¹‰ï¼šæ‹·è´åŸå§‹å¯¹è±¡çš„å±æ€§ã€‚å¦‚æœå±æ€§ä¸ºåŸºæœ¬ç±»å‹ï¼Œåˆ™æ‹·è´çš„æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼›å¦‚æœå±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€
- ç‰¹ç‚¹ï¼šæµ…æ‹·è´åªè§£å†³äº†ç¬¬ä¸€å±‚çš„é—®é¢˜ï¼Œæ‹·è´ç¬¬ä¸€å±‚çš„åŸºæœ¬ç±»å‹å€¼ï¼Œä»¥åŠç¬¬ä¸€å±‚çš„å¼•ç”¨ç±»å‹åœ°å€
- é€‚ç”¨åœºæ™¯
  - Object.assign()ï¼š`let clone = Object.assign({},obj1);`
  - spread è¯­æ³•ï¼š`let clone = {...object};`

### 2ã€æ·±æ‹·è´

- å®šä¹‰ï¼šæ‹·è´åŸå¯¹è±¡åŠå…¶å¼•ç”¨çš„æ‰€æœ‰å¯¹è±¡çš„æ‰€æœ‰å±æ€§å€¼ã€‚åŸå¯¹è±¡ä¸æ·±æ‹·è´åçš„å¯¹è±¡å®Œå…¨äº’ä¸å½±å“ã€‚
- é€‚ç”¨åœºæ™¯
  - `JSON.parse(JSON.stringify(oldObj))`
    - å®ç°äº†åºåˆ—åŒ–ä¸ååºåˆ—åŒ–
    - æ— æ³•å®ç°å¯¹`Functionã€RegExpã€Date`ç­‰ç‰¹æ®Šå¯¹è±¡çš„å…‹éš†
    - å¿½ç•¥äº† `undefinedã€symbol`
    - å¾ªç¯å¼•ç”¨æƒ…å†µä¸‹ä¼šæŠ¥é”™
  - lodash æä¾›çš„åº“\_\_.cloneDeep()ï¼šä»¥`Object.prototype.toString.call`å¾—åˆ°`tag`ï¼Œå†åˆ†ç±»å¤„ç†ï¼Œsymbol ç”±`Object.getOwnPropertySymbols`æ–¹æ³•è§£å†³
  - æ‰‹åŠ¨æ„é€ ï¼šå¯¹ä¸åŒçš„å¯¹è±¡(æ­£åˆ™ã€æ•°ç»„ã€Date ç­‰)è¦é‡‡ç”¨ä¸åŒçš„å¤„ç†æ–¹å¼
    - è€ƒè™‘æ•°ç»„
    - è€ƒè™‘å¾ªç¯å¼•ç”¨ï¼šä½¿ç”¨`WeakMap`å¼±å¼•ç”¨æ•°æ®ç»“æ„é¢å¤–å¼€è¾Ÿä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œæ¥å­˜å‚¨å½“å‰å¯¹è±¡å’Œæ‹·è´å¯¹è±¡çš„å¯¹åº”å…³ç³»ï¼Œæ‹·è´æ—¶å…ˆå»å­˜å‚¨ç©ºé—´ä¸­æ‰¾ï¼Œæœ‰æ²¡æœ‰æ‹·è´è¿‡è¿™ä¸ªå¯¹è±¡ï¼Œæœ‰ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰ç»§ç»­æ‹·è´ã€‚

```js
function clone(target) {
  if (typeof target === "object") {
    let cloneTarget = Array.isArray(target) ? [] : {};
    //WeakMapå­˜å‚¨ç©ºé—´æœ‰æ‹·è´è¿‡çš„å¯¹è±¡åˆ™ç›´æ¥è¿”å›
    const map = new WeakMap();
    if (map.has(target)) {
      return map.get(target);
    }
    //WeakMapå­˜å‚¨ç©ºé—´æ— æ‹·è´è¿‡çš„å¯¹è±¡åˆ™è®¾ç½®æ‹·è´å¯¹è±¡
    map.set(target, cloneTarget);
    //éå†è¢«å…‹éš†å¯¹è±¡å±æ€§
    for (const key in target) {
      //é€’å½’è°ƒç”¨ï¼Œæ·±æ‹·è´åä¾æ¬¡æ·»åŠ åˆ°æ–°å¯¹è±¡ä¸Š
      cloneTarget[key] = clone(target[key], map);
    }
    return cloneTarget;
  } else {
    // åŸå§‹ç±»å‹ï¼Œæ— éœ€ç»§ç»­æ‹·è´ï¼Œç›´æ¥è¿”å›
    return target;
  }
}
```

## ä¸ƒã€é˜²æŠ–ã€èŠ‚æµ

> é˜²æŠ–å’ŒèŠ‚æµçš„ä½œç”¨ï¼šå› ä¸ºæ— æ³•æ§åˆ¶ DOM äº‹ä»¶è§¦å‘çš„é¢‘ç‡ï¼Œæ‰€ä»¥éœ€åœ¨äº‹ä»¶è§¦å‘å’Œå‡½æ•°æ‰§è¡Œä¹‹é—´æ·»åŠ ä¸€ä¸ªæ§åˆ¶å±‚ï¼Œé˜²æ­¢å‡½æ•°é«˜é¢‘è°ƒç”¨ã€‚

### 1ã€é˜²æŠ–(debounce)

- å®šä¹‰ï¼šäº‹ä»¶é«˜é¢‘è§¦å‘åˆå¹¶ä¸ºæœ€åä¸€æ¬¡è§¦å‘ï¼Œè§¦å‘nç§’åå†æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè‹¥nç§’å†…åˆè¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶
  - å»¶è¿Ÿæ‰§è¡Œ(trailing=true)ï¼šlodash é»˜è®¤å¼€å¯ï¼Œäº‹ä»¶è¢«è§¦å‘ n ç§’ï¼ˆå»¶è¿Ÿï¼‰åå†æ‰§è¡Œå‡½æ•°è°ƒç”¨
  - ç«‹å³æ‰§è¡Œ(Leading=true)
- é€‚ç”¨åœºæ™¯ï¼š
  - input è¾“å…¥æ§åˆ¶ï¼šç”¨æˆ·è¿ç»­è¾“å…¥ä¸€ä¸²å­—ç¬¦åï¼Œåªä¼šåœ¨è¾“å…¥å®Œåå»æ‰§è¡Œæœ€åä¸€æ¬¡çš„æŸ¥è¯¢ajaxè¯·æ±‚ï¼Œæœ‰æ•ˆå‡å°‘è¯·æ±‚æ¬¡æ•°ï¼ŒèŠ‚çº¦è¯·æ±‚èµ„æº
  - windowçš„resizeã€scrolläº‹ä»¶ï¼šä¸æ–­åœ°è°ƒæ•´æµè§ˆå™¨çš„çª—å£å¤§å°ã€æˆ–è€…æ»šåŠ¨æ—¶ä¼šè§¦å‘å¯¹åº”äº‹ä»¶ï¼Œé˜²æŠ–è®©å…¶åªè§¦å‘ä¸€æ¬¡
- æ¨¡æ‹Ÿå®ç°

```js
// immediate è¡¨ç¤ºç¬¬ä¸€æ¬¡æ˜¯å¦ç«‹å³æ‰§è¡Œ
function debounce(fn, wait = 50, immediate) {
  //å®šä¹‰ timer å®šæ—¶å™¨
  let timer = null;
  return function(...args) {
    //æŒç»­è§¦å‘æ—¶ä¸æ‰§è¡Œï¼Œæ¸…é™¤ä¸Šä¸€æ¬¡æ‰§è¡Œæ—¶çš„å®šæ—¶å™¨
    if (timer) clearTimeout(timer);
    //é€‰æ‹©æ— å»¶è¿Ÿç«‹å³æ‰§è¡Œ
    if (immediate && !timer) {
      fn.apply(this, args);
    }
    //å®šæ—¶å™¨é‡æ–°è®¾ç½®è®¡æ—¶
    timer = setTimeout(() => {
      fn.apply(this, args);
    }, wait);
  };
}
// Demo:æ‰§è¡Œ debounce å‡½æ•°è¿”å›æ–°å‡½æ•°
const betterFn = debounce(() => console.log("fn é˜²æŠ–æ‰§è¡Œäº†"), 1000, true);
// ç¬¬ä¸€æ¬¡è§¦å‘ scroll æ‰§è¡Œä¸€æ¬¡ fnï¼Œåç»­åªæœ‰åœ¨åœæ­¢æ»‘åŠ¨ 1 ç§’åæ‰æ‰§è¡Œå‡½æ•° fn
document.addEventListener("scroll", betterFn);
```

### 2ã€èŠ‚æµ(throttle)

- å®šä¹‰ï¼šæŸå•ä½æ—¶é—´å†…åªèƒ½æœ‰ä¸€æ¬¡è§¦å‘äº‹ä»¶çš„å›è°ƒå‡½æ•°æ‰§è¡Œã€‚
- é€‚ç”¨åœºæ™¯ï¼š
  - mousemove äº‹ä»¶ï¼šé¼ æ ‡è¿ç»­ä¸æ–­åœ°è§¦å‘æŸäº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»ï¼‰ï¼Œå•ä½æ—¶é—´å†…åªè§¦å‘ä¸€æ¬¡
  - é¡µé¢çš„æ— é™åŠ è½½ï¼šéœ€è¦ç”¨æˆ·åœ¨æ»šåŠ¨é¡µé¢æ—¶ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å‘ä¸€æ¬¡ ajax è¯·æ±‚ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·åœä¸‹æ»šåŠ¨é¡µé¢æ“ä½œæ—¶æ‰å»è¯·æ±‚æ•°æ®
  - ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼šæ¯”å¦‚æ˜¯å¦æ»‘åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤šï¼Œç”¨throttleæ¥åˆ¤æ–­
- æ¨¡æ‹Ÿå®ç°

```js
// fn æ˜¯éœ€è¦èŠ‚æµå¤„ç†çš„å‡½æ•°,wait æ˜¯æ—¶é—´é—´éš”
function throttle(fn, wait) {
  // previous æ˜¯ä¸Šä¸€æ¬¡æ‰§è¡Œ fn çš„æ—¶é—´,timer æ˜¯å®šæ—¶å™¨
  let previous = 0,
    timer = null;
  return function(...args) {
    // è·å–å½“å‰æ—¶é—´ï¼Œè½¬æ¢æˆæ—¶é—´æˆ³ï¼Œå•ä½æ¯«ç§’
    let now = +new Date();
    // åˆ¤æ–­ä¸Šæ¬¡è§¦å‘çš„æ—¶é—´å’Œæœ¬æ¬¡è§¦å‘çš„æ—¶é—´å·®æ˜¯å¦å°äºæ—¶é—´é—´éš”
    if (now - previous < wait) {
      // å®šæ—¶å™¨æ—¶é—´ç»“æŸåæ‰§è¡Œå‡½æ•° fn
      if (timer) clearTimeout(timer);
      timer = setTimeout(() => {
        previous = now;
        fn.apply(this, args);
      }, wait);
    } else {
      // ç¬¬ä¸€æ¬¡æ‰§è¡Œ
      // æˆ–è€…æ—¶é—´é—´éš”è¶…å‡ºäº†è®¾å®šçš„æ—¶é—´é—´éš”ï¼Œæ‰§è¡Œå‡½æ•° fn
      previous = now;
      fn.apply(this, args);
    }
  };
}
```

## å…«ã€é«˜é˜¶å‡½æ•°

- å®šä¹‰ï¼šé«˜é˜¶å‡½æ•°æ˜¯ä¸€ä¸ªæ¥æ”¶**å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’**æˆ–è€…å°†**å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡º**çš„å‡½æ•°
- å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ï¼šå¦‚ Array.prototype.map/filter/reduce
  - map(fn(currentValue,index,array))ï¼šæ¯ä¸ªæ•°ç»„å…ƒç´ è°ƒç”¨å‡½æ•°fnï¼Œè¿”å›å„è‡ªæ•°æ®ç»“æœçš„æ•°ç»„
  - filter(fn(element,index,array))ï¼šè¿”å›ä»…é€šè¿‡æµ‹è¯•å‡½æ•°fnçš„æ•°ç»„å…ƒç´ çš„æ–°æ•°ç»„
  - reduce(fn(acc,currentValue,index,array),initial)ï¼šæ¯ä¸ªæ•°ç»„å…ƒç´ è°ƒç”¨fnåç»“æœå­˜å…¥ç´¯åŠ å™¨accï¼Œç´¯åŠ å®Œæˆåè¿”å›æ±‡æ€»å•å€¼
- å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡º
  - isType å‡½æ•°ï¼šå°† obj => { ... } è¿™ä¸€å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡º

  ```js
  let isType = type => obj => {
    return Object.prototype.toString.call(obj) === '[object ' + type + ']';
  }

  isType('String')('123');// true
  isType('Array')([1, 2, 3]);// true
  isType('Number')(123);// true
  ```

## ä¹ã€Proxy ä»£ç†å™¨

- å®šä¹‰ï¼šProxy å¯ä»¥ç”¨æ¥è‡ªå®šä¹‰å¯¹è±¡ä¸­çš„æ“ä½œï¼Œå®ç°æ•°æ®ç»‘å®šå’Œç›‘å¬
- è¯­æ³•ï¼š

```js
let p = new Proxy(target, handler);
// `target` ä»£è¡¨éœ€è¦æ·»åŠ ä»£ç†çš„å¯¹è±¡
// `handler` ç”¨æ¥è‡ªå®šä¹‰å¯¹è±¡ä¸­çš„æ“ä½œ
```

## åã€Promiseç›¸å…³

### 1ã€async

- è¯­æ³•ï¼šasync function someName(){...}
- è¡¨ç¤ºï¼šå°†å¸¸è§„å‡½æ•°è½¬æ¢æˆPromiseï¼Œè¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªPromiseå¯¹è±¡
- ç‰¹ç‚¹ï¼šasyncå‡½æ•°å†…éƒ¨çš„å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œï¼Œæ‰ä¼šæ‰§è¡Œthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°

### 2ã€await

- è¯­æ³•ï¼š[return_value] = await expression;
  - è¡¨ç¤ºï¼šå¼ºåˆ¶å…¶ä»–ä»£ç ç­‰å¾…ä¸€ä¸ª promiseå¯¹è±¡æˆ–å…¶ä»–ï¼Œç›´åˆ°Promise resolveå®Œæˆè¿”å›resultç»“æœ
- ç‰¹ç‚¹ï¼šåªèƒ½åœ¨asyncå‡½æ•°å†…éƒ¨ä½¿ç”¨
- é”™è¯¯å¤„ç†ï¼štry{await}catch{}æ•æ‰rejectedæ•°æ®æˆ–æŠ›å‡ºå¼‚å¸¸

```js
async function f1() {
  let promise = new Promise((resolve, reject) => {
    setTimeout(() => resolve("done!"), 1000)
  });
  let result = await promise; // ç­‰å¾…ç›´åˆ° promise å†³è®® (*)
  alert(result); // "done!"
}
f1();
async function f2() {
  try {
    let response = await fetch('/no-user-here');
    let user = await response.json();
  } catch(err) {
    // æ•è·åˆ° fetch å’Œ response.json ä¸­çš„é”™è¯¯
    alert(err);
  }
}
f2();
// ç­‰å¾…å¤šä¸ª promise ç»“æœ
let results = await Promise.all([
  fetch(url1),
  fetch(url2),
  ...
]);
```
